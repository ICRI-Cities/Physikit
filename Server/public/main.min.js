function Login(e,t){$.get(e+t,function(e){return"405 access denied"==e?void console.log(e):(connect_socket(t,e),$.cookie("physikit",t),SwitchLogin(!1,t),void console.log("logged in"))})}function connect_socket(e,t){console.log("Log in response: "+t.token),socket=io.connect("",{query:"token="+t.token+"&id="+e}),socket.on("smartcitizen",function(e,t){HandleSmartCitizenMessage(e,t)}),socket.on("physikit",function(e,t){HandlePhysikitMessage(e,t)}),socket.on("rules",function(e){HandleRuleMessage(e)}),socket.on("connect",function(){}),socket.on("error",function(e){("UnauthorizedError"==e.type||"invalid_token"==e.code)&&console.log("Bad token")})}function Send(e,t,o,n,i){socket.emit("message",$.cookie("physikit"),e,t,o,n,i)}function HandleLogIn(){var e=$("#logIn").val();Login(url,e)}function HandleLogOut(){$.removeCookie("physikit"),SwitchLogin(!0),socket.disconnect(),location.reload()}function SwitchLogin(e,t){e?($("#loginForm").show(),$("#loggedInForm").hide()):($("#loginForm").hide(),$("#loggedInForm").show(),$("#username").text("You are logged in as: "+t),$("#username").prop("disabled",!1))}function HandleSmartCitizenMessage(e,t){console.log(t.device.last_insert_datetime),$("#sc").html("You are currently connected to a device named "+t.device.title+" that is located in "+t.device.location+". The temperature in <strong><span style='color: #ff0000'>"+t.device.location+"</span></strong> is currently "+t.device.posts[0].temp+" and the co level is "+t.device.posts[0].co+".")}function HandlePhysikitMessage(e,t){console.log(e+" cube message: "+t);var o=t,n=o.substring(0,1),i=(o.substring(2,3),o.substring(4,5),o.substring(6,o.toString().length)),c=i>0;0==n?$("#"+e+"Checkbox").get(0).checked!=c?($("#"+e+"Checkbox").bootstrapSwitch("state",c,!0),HandleMainSwitch(e,c,!1)):($("#"+e+"Slider").slider("value",i),$("#"+e+"SliderValue").text(i)):1==n&&($("#"+e+"AlertCheckbox").get(0).checked!=c&&$("#"+e+"AlertCheckbox").bootstrapSwitch("state",c,!0),HandleSecondarySwitch(e,c,!1))}function HandleRuleMessage(e){var t=e;console.log("Rule message: "+t)}function HandleMainSwitch(e,t,o){var n=t?255:0,i=255==n;i&&(o&&Send(e,0,0,0,n),$("#"+e+"Slider").slider("value",n),$("#"+e+"SliderValue").text(n),$("#"+e+"AlertCheckbox").get(0).checked&&$("#"+e+"AlertCheckbox").bootstrapSwitch("state",!n)),i||($("#"+e+"AlertCheckbox").get(0).checked||o&&Send(e,0,0,0,n),$("#"+e+"Slider").slider("value",n),$("#"+e+"SliderValue").text(n))}function HandleSecondarySwitch(e,t,o){var n=t?255:0,i=255==n;i&&($("#"+e+"Checkbox").bootstrapSwitch("state",!i),o&&Send(e,1,0,0,n)),i||$("#"+e+"Checkbox").get(0).checked||o&&Send(e,1,0,0,n)}function HandleSliders(e,t,o){o&&Send(e,0,0,0,t);var n=t>0?!0:!1;$("#"+e+"Checkbox").bootstrapSwitch("state",n)}function HandleSwitchEvent(e,t){$("#"+e+"Checkbox").on("switchChange.bootstrapSwitch",function(o,n){HandleMainSwitch(e,n,t)}),$("#"+e+"AlertCheckbox").on("switchChange.bootstrapSwitch",function(o,n){HandleSecondarySwitch(e,n,t)}),$("#"+e+"Slider").slider({orientation:"horizontal",range:"min",min:0,max:255,value:0,stop:function(o,n){HandleSliders(e,n.value,t)},slide:function(t,o){$("#"+e+"SliderValue").text(o.value)}})}var socket,url="https://physikit.herokuapp.com/api/";$(document).ready(function(){var e=$.cookie("physikit");void 0==e?SwitchLogin(!0):Login(url,e),$("#accordion").accordion({header:"h3"}),$("[type='checkbox']").bootstrapSwitch(),HandleSwitchEvent("light",!0),HandleSwitchEvent("fan",!0),HandleSwitchEvent("buzz",!0),HandleSwitchEvent("move",!0)});